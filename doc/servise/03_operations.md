# ç¬¬3éƒ¨ï¼šé‹ç”¨ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

## ðŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€WellFinã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆã€é‹ç”¨æˆ¦ç•¥ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’è¨˜è¼‰ã™ã‚‹é‹ç”¨ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é‹ç”¨ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç®¡ç†ã—ã¾ã™ã€‚

## 7. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹çµ±åˆå®Œäº† âœ… **doc/servise/06_usecase.md ã«ç§»è¡Œ**

> **ðŸ“ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ç§»è¡Œå®Œäº†**  
> ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆ7.1-7.5ï¼‰ã®è©³ç´°ã¯ä»¥ä¸‹ã«ç§»è¡Œã—ã¾ã—ãŸï¼š
> - **çµ±åˆå…ˆ**: [`doc/servise/06_usecase.md`](./06_usecase.md#7-ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å€‹äººå‘ã‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼çµ±åˆ-å®Ÿè£…å®Œäº†)
> - **ç§»è¡Œå†…å®¹**: è©³ç´°å®Ÿè£…çŠ¶æ³ãƒ»æˆåŠŸåŸºæº–ãƒ»å®Ÿè£…åŸºç›¤ã¨ã®æ•´åˆæ€§ç¢ºèª
> - **çµ±åˆå“è³ª**: ç¾çŠ¶å®Ÿè£…ã¨ã®å®Œå…¨ä¸€è‡´ãƒ»æŠ€è¡“çš„æ­£ç¢ºæ€§ç¢ºä¿

### 7.1 ç§»è¡Œæ¸ˆã¿ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹æ¦‚è¦

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | å®Œæˆåº¦ | ç§»è¡Œå…ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ | å“è³ªãƒ¬ãƒ™ãƒ« |
|-------------|--------|----------------|------------|
| ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªã¨èª¿æ•´ | **100%+** | 7.2.1 | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ å“è³ª |
| é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ã®äºˆå®šç®¡ç† | **100%+** | 7.2.2 | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ å“è³ª |
| ç¿’æ…£ã®æ™‚é–“å¸¯æœ€é©åŒ– | **95%** | 7.2.3 | é«˜å“è³ª |
| ç›®æ¨™ã«å‘ã‘ãŸã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚° | **95%** | 7.2.4 | é«˜å“è³ª |
| ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¦‹ç›´ã— | **90%** | 7.2.5 | é«˜å“è³ª |

**çµ±åˆå®Œäº†äº‹é …**:
- âœ… è©³ç´°ã‚·ãƒŠãƒªã‚ªã¨å®Ÿè£…çŠ¶æ³
- âœ… Phaseåˆ¥æˆåŠŸåŸºæº–é”æˆçŠ¶æ³
- âœ… å®Ÿè£…åŸºç›¤ã¨ã®æ•´åˆæ€§ç¢ºèª
- âœ… æŠ€è¡“çš„æˆæžœãƒ»é©æ–°ã®è©³ç´°
- âœ… å“è³ªä¿è¨¼ãƒ»æ¤œè¨¼çµæžœ

## 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 8.1 Firebaseã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«

**Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ä¾‹**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚‚åŒæ§˜
      match /{collection}/{docId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã•ã‚‰ã«åˆ¶é™ãŒå¿…è¦ï¼‰
    match /admin/{docId} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}
```

### 8.2 èªè¨¼ãƒ»èªå¯ç®¡ç†
- **Firebase Authentication**: Googleèªè¨¼å°‚ç”¨
- **Cloud IAM**: èªè¨¼ã¨èªå¯ã®ç®¡ç†
- **JWTãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†**: ã‚»ã‚­ãƒ¥ã‚¢ãªæ›´æ–°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ã¨ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°

### 8.3 ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: è»¢é€ä¸­ãŠã‚ˆã³ä¿å­˜æ™‚ã®æš—å·åŒ–
- **APIã‚­ãƒ¼ç®¡ç†**: Secret Managerã«ã‚ˆã‚‹å®‰å…¨ãªç®¡ç†
- **ç’°å¢ƒå¤‰æ•°**: æ©Ÿå¯†æƒ…å ±ã®å®‰å…¨ãªç®¡ç†
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«ã§ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢

### 8.4 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿åˆ†é›¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- **æœ€å°æ¨©é™ã®åŽŸå‰‡**: å¿…è¦æœ€å°é™ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- **ãƒ‡ãƒ¼ã‚¿å‰Šé™¤**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ™‚ã®å®Œå…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
- **ç›£æŸ»ãƒ­ã‚°**: ã‚¢ã‚¯ã‚»ã‚¹å±¥æ­´ã®è¨˜éŒ²ã¨ç›£è¦–

## 9. é‹ç”¨æˆ¦ç•¥

### 9.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é‹ç”¨

#### 9.1.1 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©
åŠ¹çŽ‡çš„ãªã‚¯ã‚¨ãƒªã®ãŸã‚ã«å¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©ï¼š

```javascript
// ã‚¿ã‚¹ã‚¯æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
collection('users/{userId}/tasks') {
  fields(status, scheduledDate, ASC)
  fields(priority, DESC, scheduledDate, ASC)
  fields(goalId, scheduledDate, ASC)
}

// ç¿’æ…£æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
collection('users/{userId}/habits') {
  fields('frequency.type', 'frequency.daysOfWeek')
  fields('streak.current', DESC)
  fields('category', 'streak.current', DESC)
}

// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
collection('users/{userId}/calendar') {
  fields(startTime, ASC)
  fields(calendarId, startTime, ASC)
}

// é€šçŸ¥æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆðŸ“… å®Ÿè£…äºˆå®šï¼‰
collection('users/{userId}/notifications') {
  fields(read, createdAt, DESC)
  fields(priority, createdAt, DESC)
}
```

#### 9.1.2 ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
ä¸»è¦ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ã„ãŸåŠ¹çŽ‡çš„ãªã‚¯ã‚¨ãƒªä¾‹ï¼š

**æœ¬æ—¥ã®ã‚¿ã‚¹ã‚¯å–å¾—**
```javascript
db.collection('users').doc(userId)
  .collection('tasks')
  .where('scheduledDate', '>=', todayStart)
  .where('scheduledDate', '<=', todayEnd)
  .where('status', 'in', ['pending', 'in_progress'])
  .orderBy('scheduledTimeStart', 'asc')
  .get()
```

**ç‰¹å®šã®ç›®æ¨™ã«é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯å–å¾—**
```javascript
db.collection('users').doc(userId)
  .collection('tasks')
  .where('goalId', '==', goalId)
  .orderBy('scheduledDate', 'asc')
  .get()
```

**æœ¬æ—¥ã®ç¿’æ…£å–å¾—**
```javascript
// æ—¥æ¬¡ç¿’æ…£ã®å ´åˆ
db.collection('users').doc(userId)
  .collection('habits')
  .where('frequency.type', '==', 'daily')
  .get()

// é€±æ¬¡ç¿’æ…£ã®å ´åˆï¼ˆæœ¬æ—¥ã®æ›œæ—¥ã«è©²å½“ï¼‰
db.collection('users').doc(userId)
  .collection('habits')
  .where('frequency.type', '==', 'weekly')
  .where('frequency.daysOfWeek', 'array-contains', todayDayOfWeek)
  .get()
```

**æœªèª­é€šçŸ¥å–å¾—**
```javascript
db.collection('users').doc(userId)
  .collection('notifications')
  .where('read', '==', false)
  .orderBy('createdAt', 'desc')
  .limit(20)
  .get()
```

### 9.2 ãƒ‡ãƒ¼ã‚¿åŒæœŸæˆ¦ç•¥

#### 9.2.1 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
- ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯
- æœªèª­é€šçŸ¥
- é€²è¡Œä¸­ã®ç¿’æ…£

#### 9.2.2 ãƒãƒƒãƒåŒæœŸ
- å±¥æ­´ãƒ‡ãƒ¼ã‚¿
- åˆ†æžãƒ¬ãƒãƒ¼ãƒˆ
- éŽåŽ»ã®ã‚¿ã‚¹ã‚¯

#### 9.2.3 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚µãƒãƒ¼ãƒˆ
- Firebase Firestoreã®è‡ªå‹•ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹åŒ–
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ™‚ä¿å­˜ã¨ç«¶åˆè§£æ±ºæˆ¦ç•¥ã®å®Ÿè£…

### 9.3 ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

#### 9.3.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- Firestoreã®å®šæœŸçš„ãªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- Cloud Functionsã‚’ä½¿ç”¨ã—ãŸé‡è¦ãƒ‡ãƒ¼ã‚¿ã®å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

#### 9.3.2 ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ
- ã‚¹ã‚­ãƒ¼ãƒžãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã®ç§»è¡Œæˆ¦ç•¥

#### 9.3.3 ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- å¤ã„ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆæœ€é©åŒ–

### 9.4 ç›£è¦–ãƒ»ãƒ­ã‚°ç®¡ç†

#### 9.4.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›£è¦–
- **Firebase Performance**: ã‚¢ãƒ—ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›£è¦–
- **Cloud Monitoring**: ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–
- **Error Reporting**: ã‚¨ãƒ©ãƒ¼è¿½è·¡ã¨åˆ†æž
- **Firebase Crashlytics**: ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆåŽé›†

#### 9.4.2 ãƒ­ã‚°ç®¡ç†
- **Cloud Logging**: çµ±åˆãƒ­ã‚°ç®¡ç†
- **Firebase Analytics**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æž
- **ç›£æŸ»ãƒ­ã‚°**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²

### 9.5 ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 9.5.1 ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã®æœ€é©åŒ–
- ä¸å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¹ãƒˆã‚’é¿ã‘ã‚‹
- ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®é©åˆ‡ãªä½¿ç”¨
- åŠ¹çŽ‡çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

#### 9.5.2 ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹
- è¤‡åˆã‚¯ã‚¨ãƒªã«å¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—æ™‚ï¼‰
- ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

#### 9.5.3 ã‚³ã‚¹ãƒˆç®¡ç†
- ãƒªãƒ¼ãƒ‰/ãƒ©ã‚¤ãƒˆæ“ä½œã®æœ€é©åŒ–
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ•°ã®ç®¡ç†
- ä¸è¦ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã®å›žé¿
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã®ç›£è¦–

#### 9.5.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
- é©åˆ‡ãªèªè¨¼ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–
- å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®ç¶™ç¶šçš„æ”¹å–„

---

*æœ€çµ‚æ›´æ–°: 2025å¹´6æœˆ28æ—¥* 