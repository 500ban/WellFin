# Cursor Rules for WellFin Project

## ドキュメント運用ルール

- ドキュメント更新時は必ず `doc/README.md` を確認し、構成・反映先・更新ルールに従うこと。
- 変更内容が複数ドキュメントにまたがる場合は、関連する全てのドキュメントを一貫して更新すること。
- リリースノート、トラブルシューティング、実装計画、作業ログなど、各種履歴系ドキュメントは最新状態を保つこと。
- ドキュメントの最終更新日・バージョン履歴を明記すること。
- **重要**: 日付記録時は必ず `date` コマンドで現在日付を確認し、正確な日付を記録すること。

## コード・実装ルール

- Flutterアプリのコマンドは必ず`flutter`ディレクトリで専用のスクリプト`.\scripts\flutter-dev.bat`を実行すること。
- UI/UX改善やバグ修正時は、実装内容・技術的背景・解決策を必ずドキュメントに反映すること。
- 実機・エミュレーター間の挙動差がある場合は、両方での動作確認・記録を徹底すること。

### Riverpod/Flutter開発ルール

- **型安全性の徹底**: `WidgetRef`と`Ref`の使い分けを厳守すること
  - `WidgetRef`: ConsumerWidget/ConsumerStateで使用
  - `Ref`: Provider/Service層で使用
  - 型キャスト（`ref as Ref`）は避け、適切な型を使用すること

- **責務分離の明確化**: 各層の役割を明確に分離すること
  - UI層: ユーザーインタラクション、画面表示
  - Provider層: データ管理、ビジネスロジック
  - Service層: 外部API連携、データ処理

- **根本原因の特定**: エラーの症状だけでなく、設計全体を見直すこと
  - 型エラーが発生した場合は、設計レベルでの問題を疑う
  - 段階的なデバッグと設計レビューを実施すること

- **シンプルな解決策**: 複雑な回避策よりも、正しい設計に戻すことを優先すること
  - 過度な抽象化を避ける
  - 既存の設計原則に従う

## Agent運用ルール

- Agentによる作業は `doc/agent_log.md` に必ず記録すること。
- 技術的な決定事項・課題・解決策は、関連ドキュメントに明記すること。
- ドキュメント更新時は、既存のルール・構成を尊重し、重複や矛盾がないように注意すること。
- **トラブルシューティング記録**: 問題解決後は必ず `doc/develop_trouble.md` に詳細を記録すること。

## 品質管理ルール

- **実装前レビュー**: 型安全性と責務分離を重点的にチェックすること
- **段階的実装**: 小さな単位で実装し、各段階でテストすること
- **即座の修正**: 問題が発生したら即座に修正し、根本原因を特定すること

---

（参考: https://docs.cursor.com/context/rules ） 